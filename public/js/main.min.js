let restaurants,neighborhoods,cuisines;var map,markers=[];let selectFavorite=!1;document.addEventListener("DOMContentLoaded",e=>{const t=document.getElementById("show_map");t.addEventListener("click",()=>{document.getElementById("map").style.display="block",t.style.display="none"}),fetchNeighborhoods(),fetchCuisines(),registerServiceWorker()});const registerServiceWorker=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").then(e=>{console.log("successful register the service worker")})},fetchNeighborhoods=()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=(e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})},fetchCuisines=()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=(e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})};window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()});const updateRestaurants=()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),s=e.selectedIndex,r=t.selectedIndex,n=e[s].value,a=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(n,a,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},favoriteRestaurants=(e=self.restaurants)=>e&&selectFavorite?(console.log("restaurants at favorits is ",e),e.filter(e=>"true"===e.is_favorite)):e||[],toggleVisibleRestaurants=e=>{const{selectedIndex:t}=e.target;1===t?(selectFavorite=!0,console.log(selectFavorite),updateRestaurants()):0===t&&(selectFavorite=!1,updateRestaurants())},resetRestaurants=e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e};function lazyImages(){const e=document.querySelectorAll("img"),t=e=>{const t=e.dataset.src;(e=>(console.log(e),new Promise((t,s)=>{const r=new Image;r.src=e,r.onload=t,r.onerror=s})))(t).then(()=>{e.src=t})},s=new IntersectionObserver((e,s)=>{e.forEach(e=>{e.intersectionRatio>0&&(console.log(e.intersectionRatio),t(e.target))})},{root:null,rootMargin:"0px",threshold:.1});e.forEach(e=>{s.observe(e)})}const fillRestaurantsHTML=(e=favoriteRestaurants(self.restaurants))=>{console.log("updating",e);const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),lazyImages(),addMarkersToMap(e)},createRestaurantHTML=e=>{const t=document.createElement("li"),s=document.createElement("img");s.className="restaurant-img",s.alt=`${e.name} restaurant, address ${e.address}, ${e.cuisine_type} cuisine`,s.setAttribute("data-src",DBHelper.imageUrlForRestaurant(e)),t.append(s);const r=document.createElement("h3");r.innerHTML=e.name,t.append(r);const n=document.createElement("p");n.innerHTML=e.neighborhood,t.append(n);const a=document.createElement("p");a.innerHTML=e.address,t.append(a);const o=document.createElement("a");o.innerHTML="View Details",o.href=DBHelper.urlForRestaurant(e),t.append(o);const l=document.createElement("p");return l.classList.add("heart"),"true"===e.is_favorite&&l.classList.add("active"),l.addEventListener("click",()=>{const{is_favorite:t}=e;DBHelper.changeRestaurantFavorite(e,(e,s)=>{t!==s&&l.classList.toggle("active")})}),t.appendChild(l),t},addMarkersToMap=(e=favoriteRestaurants(self.restaurants))=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})};